{
  "schemaVersion": "0.3",
  "description": "Add Inbound Rule to EC2 Security Group",
  "parameters": {
    "SecurityGroupId": {
      "type": "String",
      "description": "The ID of the Security Group to which the rule should be added."
    },
    "IpAddress": {
      "type": "String",
      "description": "The IP address or IP range (in CIDR notation) to allow access from."
    },
    "PortNumber": {
      "type": "String",
      "description": "The port number to open for inbound traffic (e.g., 22 for SSH)."
    }
  },
  "mainSteps": [
    {
      "action": "aws:runShellScript",
      "name": "addInboundRule",
      "inputs": {
        "runCommand": [
          "result=$(aws ec2 authorize-security-group-ingress --group-id $SecurityGroupId --protocol tcp --port $PortNumber --cidr $IpAddress/32)",
          "echo '{\"SecurityGroupRuleId\": \"$result\"}'"
        ]
      },
      "outputs": [
        {
          "name": "SecurityGroupRule",
          "description": "The details of the added Security Group Rule.",
          "type": "String",
          "value": "{{ addInboundRule }}"
        }
      ]
    }
  ]
}
