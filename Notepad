{
  "schemaVersion": "0.3",
  "description": "Add Inbound Rule to Existing Security Group",
  "parameters": {
    "SecurityGroupId": {
      "type": "String",
      "description": "The ID of the Security Group to which the rule should be added."
    },
    "IpAddress": {
      "type": "String",
      "description": "The IP address or IP range (in CIDR notation) to allow access from."
    },
    "PortNumber": {
      "type": "String",
      "description": "The port number to open for inbound traffic (e.g., 22 for SSH)."
    }
  },
  "mainSteps": [
    {
      "action": "aws:executeScript",
      "name": "addInboundRule",
      "inputs": {
        "runCommand": [
          "#!/bin/bash",
          "SG_ID=${SsmAutomationParameters['SecurityGroupId']}",
          "PORT=${SsmAutomationParameters['PortNumber']}",
          "CIDR=${SsmAutomationParameters['IpAddress']}",
          "aws ec2 authorize-security-group-ingress --group-id $SG_ID --protocol tcp --port $PORT --cidr $CIDR"
        ]
      },
      "outputs": [
        {
          "type": "String",
          "default": "No output"
        }
      ]
    }
  ]
}
